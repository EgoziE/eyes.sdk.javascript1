<p align="center">
  <br/>
  <svg xmlns="http://www.w3.org/2000/svg" width=200 viewBox="0 0 192.4 35.2"><path fill="#00a399" d="M46.9 23v-2.4c-.9-1.1-2.5-1.7-4.1-1.7-2 0-3.7 1-3.7 3 0 1.8 1.6 2.8 3.7 2.8 1.6 0 3.2-.5 4-1.7m0 4.7v-2a8 8 0 0 1-6.1 2.5c-3.1 0-6.8-2-6.8-6.4 0-4.7 3.7-6.4 6.8-6.4 2.6 0 4.9.9 6.2 2.4v-2.4c0-2-1.7-3.3-4.3-3.3-2 0-4 .8-5.6 2.3l-2-3.6c2.3-2.1 5.4-3 8.5-3C48 7.7 52 9.4 52 15v12.6zM69.6 18c0-3.4-2-5.7-5-5.7-1.6 0-3.5 1-4.4 2.2v6.9a5.8 5.8 0 0 0 4.4 2.3c3 0 5-2.4 5-5.7m-9.4 7.2v10h-5.1v-27h5.1v2.5c1.5-2 3.7-3 6-3 5 0 8.7 3.7 8.7 10.3 0 6.5-3.6 10.2-8.7 10.2-2.3 0-4.4-1-6-3M91.1 18c0-3.4-2-5.7-5-5.7-1.6 0-3.4 1-4.3 2.2v6.9a5.8 5.8 0 0 0 4.4 2.3c3 0 5-2.4 5-5.7m-9.4 7.2v10h-5.2v-27h5.2v2.5c1.5-2 3.6-3 6-3 5 0 8.6 3.7 8.6 10.3 0 6.5-3.6 10.2-8.6 10.2-2.3 0-4.4-1-6-3M98.2.8h5.1v27h-5.1zM106.4 8.2h5.1v19.5h-5.1zm-.5-5.2a3 3 0 0 1 3-3 3 3 0 0 1 3.1 3 3 3 0 0 1-3 3.1 3 3 0 0 1-3.1-3M115.6 22.8V12.7h-3.2V8.2h3.2V3h5.2v5.3h4v4.5h-4v8.8c0 1.2.6 2.2 1.8 2.2.7 0 1.5-.3 1.7-.7l1.1 4c-.7.7-2.1 1.2-4.3 1.2-3.6 0-5.5-1.8-5.5-5.4"></path><path fill="#00a399" d="M140.3 18c0-3-1.8-5.7-5-5.7s-5 2.6-5 5.7c0 3 1.8 5.7 5 5.7s5-2.7 5-5.7M125 18a9.9 9.9 0 0 1 10.3-10.3A9.9 9.9 0 0 1 145.6 18a10 10 0 0 1-10.3 10.2A10 10 0 0 1 125 18M161.5 18c0-3-1.8-5.7-5-5.7s-5 2.6-5 5.7c0 3 1.8 5.7 5 5.7s5-2.7 5-5.7m-15.3 0a9.9 9.9 0 0 1 10.3-10.3A9.9 9.9 0 0 1 167 18a10 10 0 0 1-10.4 10.2A10 10 0 0 1 146.2 18M168.7.8h5.1v27h-5.1zM175.2 25.2l2.2-3.7a11 11 0 0 0 6.8 2.7c2.2 0 3.2-.9 3.2-2 0-3.3-11.5-.7-11.5-8.3 0-3.3 2.8-6.2 8-6.2 3.3 0 5.9 1.2 7.8 2.7l-2 3.6a8.4 8.4 0 0 0-5.8-2.2c-1.9 0-3 .8-3 1.9 0 2.8 11.5.4 11.5 8.3 0 3.6-3 6.2-8.5 6.2-3.4 0-6.7-1.1-8.7-3"></path><path fill="#a7a9ac" d="M16.3 22l-1.4-.8a38.8 38.8 0 0 0-6.4-3.4c2.8-1.3 5.5-2.7 7.9-4.3a23.7 23.7 0 0 1-.1 8.6m6.1-13.2V4.4a86 86 0 0 1-5 4.1A16.5 16.5 0 0 0 11.3 3c1.8 1.9 3.3 4.3 4.3 7A66 66 0 0 1 0 17.8a75 75 0 0 1 15.4 7.7c-1 2.6-2.4 5-4.2 6.8 2.5-1.3 4.6-3.1 6.1-5.4 2.4 1.8 4.3 3.5 5.1 4.2v-4.4l-1.7-1.5L19 24a16.4 16.4 0 0 0 0-12.5c1.3-.8 2.4-1.8 3.4-2.6"></path>
  </svg>

  <h2 align="center"> Eyes-Testcafe</h1>
  <h4 align="center">Eyes SDK for <a href="https://devexpress.github.io/testcafe/">Testcafe</a></h1>

  <br/>
  <div align="center">
    <img src="https://img.shields.io/badge/classic-beta-yellow" style="margin-right: 10px">
    <img src="https://img.shields.io/badge/node-%3E%3D%2010-green">
  </div>
  <br/><br/>
</p>
<br/>

## Installation

Install Eyes-Testcafe as a local dev dependency in your tested project:

```bash
npm i -D @applitools/eyes-testcafe@beta
```

## Applitools API key

In order to authenticate via the Applitools server, you need to supply the Eyes-Testcafe SDK with the API key you got from Applitools. Read more about how to obtain the API key [here](https://applitools.com/docs/topics/overview/obtain-api-key.html).

To to this, set the environment variable `APPLITOOLS_API_KEY` to the API key before running your tests.
For example, on Linux/Mac:

```bash
export APPLITOOLS_API_KEY=<your_key>
npx testcafe chrome:headless some-test-dir
```

And on Windows:

```bash
set APPLITOOLS_API_KEY=<your_key>
npx testcafe chrome:headless some-test-dir
```

## Usage

After defining the API key, you will be able to use commands from Eyes-Testcafe in your testcafe tests to take screenshots and use Applitools Eyes to manage them:

### Example

```js
import {Eyes, Target} from '@applitools/eyes-testcafe';

const eyes = new Eyes();

fixture`Hello world`
  .page('https://applitools.com/helloworld')
  .afterEach(() => eyes.close());
  
test('Hello world page', async t => {
  await eyes.open(t, 'Hello World!', 'My first JavaScript test!', {width: 1200, height: 800});
  await eyes.check('Main Page', Target.window());
  await t.click('button')
  await eyes.check('Click!', Target.window());
});
```

## API

### open

Create an Applitools test.
This will start a session with the Applitools server.

```js
eyes.open(t, appName, testName, viewportSize)
```

### check

Generate a screenshot of the current page and add it to the Applitools Test.

```js
eyes.check(tag, checkSettings)
```

#### Arguments to `eyes.check`

##### `tag`

Defines a name for the checkpoint in the Eyes Test Manager. The name may be any string and serves to identify the step to the user in the Test manager. You may change the tag value without impacting testing in any way since Eyes does not use the tag to identify the baseline step that corresponds to the checkpoint - Eyes matches steps based on their content and position in the sequences of images of the test. See [How Eyes compares checkpoints and baseline images](https://applitools.com/docs/topics/general-concepts/how-eyes-compares-checkpoints.html) for details.

##### `checkSettings`

Holds the checkpoint's configuration. This is defined using the fluent API, starting with `Target`.

- For taking a viewport screenshot, call `Target.window()`.
- For a full page screenshot, call `Target.window().fully()`.

### close

Close the applitools test and check that all screenshots are valid.

It is important to call this at the end of each test, symmetrically to `open`(or in `afterEach()`, see [Best practice for using the SDK](#best-practice-for-using-the-sdk)).

```js
const testResults = await eyes.close(throwEx);
```

## Best practice for using the SDK

Every call to `eyes.open` and `eyes.close` defines a test in Applitools Eyes, and all the calls to `eyes.check` between them are called "steps". In order to get a test structure in Applitools that corresponds to the test structure in Testcafe, it's best to open/close tests in every `test` call. **You can use `afterEach` for calling `eyes.close()`**

```js
fixture`Hello world`
  .page('https://applitools.com/helloworld')
  .afterEach(async () => eyes.close());
```
