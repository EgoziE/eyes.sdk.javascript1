<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <!-- <div id="el"></div> -->
  <script>
    const map = new WeakMap()
    Object.defineProperties(Element.prototype, {
      attachShadow: {
        value: function attachShadow(options) {
          console.log('attachShadow', options)
          const div = document.createElement('div')
          div.textContent = 'hi there'
          const frag = document.createDocumentFragment()
          frag.appendChild(div)
          map.set(this, frag)
          return frag
        },
        configurable: true,
        enumerable: true,
        writable: true
      },
      shadowRoot: {
        get: function getShadowRoot() {
          console.log('getShadowRoot', this)
          return map.get(this)
        },
        enumerable: true,
        configurable: true
      }
    })

    window.onload = () => {
      const el = document.createElement('div')
      el.id = 'el'
      el.attachShadow({mode: 'open'})
      document.body.appendChild(el)
    }
  </script>
</body>
</html>
