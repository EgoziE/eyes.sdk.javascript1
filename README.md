# visual-grid-client

A library that drives the visual grid with dom snapshot rendering.

## Installing

```sh
npm install @applitools/visual-grid-client
```

## Using the package

* Requiring the module returns an object with three properties:

```js
const {makeVisualGridClient, createLogger, initConfig} = require('@applitools/visual-grid-client')

```

See below for the API.

## API

### `makeVisualGridClient`

* To create a visualGridClient, call `makeVisualGridClient`:

```js
const visualGridClient = makeVisualGridClient({...initConfig(), showLogs: true, renderStatusTimeout: 60000, renderStatusInterval: 1000})
```

Where:

* `initConfig` returns an object with default config functions used by the `visualGridClient`.
  To understand more about configuration, see the "Configuration" section for more details.
* `showLogs` is obvious from name. See "Logs" section for details on the logs generated by the visual grid client.
* `renderStatusTimeout` defines the time to wait for a rendering to finish before giving up and calling it a failure.
* `renderStatusInterval` defines the time to wait between polling for a rendering's status.

The visualGridClient, returned by `makeVisualGridClient`, is an object with three functions:

* `openEyes`: to start a set of tests, where each step is a set of renderings according to the browser
  stuff in the configuration.
  This function will return an object with functions (see below) allowing you to create renderings (or "steps" in
  Applitools parlance) for the test.
* `waitForTestResults`: ???
* `getError`: ???

### `openEyes`

`openEyes` will create a test. Actually, it will create a series of test, one for each browser configuration
defined in the `browser` property of the configuraion.

* `openEyes` accepts a configuration object that will override the default configuration found by
  `makeVisualGridClient`, per this test.

* Returns an object with the following functions:

* `checkWindow(_lots_ of parameters - see below)`: creates a "step" that checks the window according to the baseline. Note that this
  function will not fail, and you need to call `waitForTestResults` to wait for the failure or success
  of a batch of steps in the test.
* `close()`: closes the test (or series of tests) created by `openEyes`. Again, this will not fail or succeed,
  but you need to call `waitForTestResults`...
* `abort()`: if you want to abort this test (or series of tests).

### `checkWindow`

* `checkWindow` should receive an object with the following parameters:

* `tag`: the name of the step, as seen in Applitools Eyes.
* `url`: the URL appearing in the address bar of the browser. All relative URLs in the CDT will be relative to it.
* `cdt`: the HTML and set and resources, in the `x-applitools-html/cdt` format (see below)
* `sizeMode`: the target of the rendering. Can be one of `viewport`, `full-page`, `selector`, `region`
* `selector`: if the `sizeMode` is selector, this is the selector we are targetting.
* `region`: if the `sizeMode` is region, this is the region we are targetting.
  This is an object with `x`, `y`, `width`, `height` properties.
* `ignore`: TBD
* `domCapture`: ???
* `scriptHooks`: ???
* `resourceUrls`?: By default, an empty array. Additional resource URLs not found in the CDT.
* `resourceContents`: ???

### The CDT format

## Configuration

* See [Eyes Cypress configuration](https://github.com/applitools/eyes.cypress#advanced-configuration)
  for a list of properties in the configuration and to understand how the visual grid client
  reads the configuration.

## Logging

???
